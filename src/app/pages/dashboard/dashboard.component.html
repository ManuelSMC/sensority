<div class="dashboard">
  <div class="topbar">
    <div class="brand">Sensority</div>
    <div class="actions">
      <button class="chip">Lecturas</button>
      <button class="chip alt">Resumen</button>
      <button pButton label="Cerrar sesión" class="logout" (click)="logout()"></button>
    </div>
  </div>

  <header class="hero card">
    <div>
      <h1>Panel de Datos Ambientales</h1>
      <p>Visualización estática de temperatura y humedad capturadas por el backend.</p>
    </div>
  </header>

  <section class="filters card">
    <div class="filters-row">
      <div class="field">
        <label>Rango de fechas</label>
        <div class="date-range">
          <div class="date-input">
            <span class="label">Inicio</span>
            <input type="date" [(ngModel)]="startDate" />
          </div>
          <span class="dash">—</span>
          <div class="date-input">
            <span class="label">Fin</span>
            <input type="date" [(ngModel)]="endDate" />
          </div>
        </div>
      </div>
      <div class="field actions">
        <button pButton label="Aplicar" (click)="applyFilter()"></button>
        <button pButton label="Reset" class="secondary" (click)="resetFilter()"></button>
        <button
          pButton
          label="Exportar CSV"
          icon="pi pi-download"
          [rounded]="true"
          severity="primary"
          [raised]="true"
          class="accent"
          (click)="exportCSV()"
        ></button>
      </div>
    </div>
    <p class="hint">Filtra por fecha local; UTC mostrado en la tabla para referencia.</p>
  </section>

  <section class="stats">
    <div class="card stat">
      <div class="stat-label">Temperatura promedio</div>
      <div class="stat-value">{{ avgTemp }} °C</div>
    </div>
    <div class="card stat">
      <div class="stat-label">Humedad promedio</div>
      <div class="stat-value">{{ avgHum }} %</div>
    </div>
  </section>

  <section class="charts">
    <div class="card chart">
      <div class="chart-header">Temperatura</div>
      <div class="chart-body">
        <canvas baseChart [data]="tempChartData" [options]="chartOptions"></canvas>
      </div>
    </div>
    <div class="card chart">
      <div class="chart-header">Humedad</div>
      <div class="chart-body">
        <canvas baseChart [data]="humChartData" [options]="chartOptions"></canvas>
      </div>
    </div>
  </section>

  <section class="table card">
    <div class="table-inner">
    <div class="table-header">
      <h2>Lecturas recientes</h2>
      <div class="legend">
        <span class="dot temp"></span> Temp
        <span class="dot hum"></span> Hum
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>Temperatura (°C)</th>
          <th>Humedad (%)</th>
          <th>Hora local</th>
          <th>UTC</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of pagedReadings">
          <td>{{ r.temp }}</td>
          <td>{{ r.hum }}</td>
          <td>{{ r.timestamp_local }}</td>
          <td><code>{{ r.timestamp_utc }}</code></td>
        </tr>
      </tbody>
    </table>
    <div class="paginator">
      <button class="pg-btn edge" (click)="goToPage(1)" [disabled]="currentPage === 1">«</button>
      <button class="pg-btn" (click)="prevPage()" [disabled]="currentPage === 1">‹</button>

      <div class="pg-pages">
        <button
          *ngFor="let p of getPageNumbers()"
          class="pg-number"
          [class.active]="p === currentPage"
          (click)="goToPage(p)"
        >{{ p }}</button>
      </div>

      <button class="pg-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">›</button>
      <button class="pg-btn edge" (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">»</button>

      <span class="pg-info">Página {{ currentPage }} de {{ totalPages }}</span>
    </div>
    </div>
  </section>
</div>
